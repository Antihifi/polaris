[gd_resource type="BehaviorTree" load_steps=86 format=3 uid="uid://b12icb31evg1h"]

[ext_resource type="Script" uid="uid://sqio3xelte7" path="res://ai/tasks/bt_check_need_critical.gd" id="1_n2iu8"]
[ext_resource type="Script" uid="uid://bh616mm1sxk16" path="res://ai/tasks/bt_generate_wander_target.gd" id="1_wander"]
[ext_resource type="Script" uid="uid://5cieec4vq4ck" path="res://ai/tasks/bt_move_to_blackboard.gd" id="2_move"]
[ext_resource type="Script" uid="uid://w162bukdvt4w" path="res://ai/tasks/bt_find_nearest_resource.gd" id="3_resource"]
[ext_resource type="Script" uid="uid://m4jkxs0hlfat" path="res://ai/tasks/bt_find_bed.gd" id="4_bed"]
[ext_resource type="Script" uid="uid://bh1neaedkfwvc" path="res://ai/tasks/bt_debug_wait.gd" id="5_8wn8u"]
[ext_resource type="Script" uid="uid://bo5vn3dbnes1y" path="res://ai/tasks/bt_find_food_container.gd" id="5_food"]
[ext_resource type="Script" uid="uid://bykl1y5nfrf7x" path="res://ai/tasks/bt_find_seat.gd" id="6_3jy6i"]
[ext_resource type="Script" uid="uid://b8uhoin5thywl" path="res://ai/tasks/bt_align_with_marker.gd" id="7_ihniq"]
[ext_resource type="Script" uid="uid://dsy6mbaichwoq" path="res://ai/tasks/bt_find_fire_spot.gd" id="8_rdl7w"]
[ext_resource type="Script" uid="uid://c2l06t652upks" path="res://ai/tasks/bt_set_animation_lock.gd" id="9_brwnp"]
[ext_resource type="Script" uid="uid://cstgkbnkkxnkt" path="res://ai/tasks/bt_face_target.gd" id="9_n2iu8"]

[sub_resource type="BlackboardPlan" id="BlackboardPlan_bo4pt"]
var/player_command_active/name = &"player_command_active"
var/player_command_active/type = 1
var/player_command_active/value = false
var/player_command_active/hint = 0
var/player_command_active/hint_string = ""
var/current_action/name = &"current_action"
var/current_action/type = 4
var/current_action/value = "Idle"
var/current_action/hint = 0
var/current_action/hint_string = ""
var/target_position/name = &"target_position"
var/target_position/type = 9
var/target_position/value = Vector3(inf, inf, inf)
var/target_position/hint = 0
var/target_position/hint_string = ""

[sub_resource type="BBVariant" id="BBVariant_ql6da"]
type = 1
saved_value = true
resource_name = "true"

[sub_resource type="BTCheckVar" id="BTCheckVar_asu1a"]
variable = &"player_command_active"
value = SubResource("BBVariant_ql6da")

[sub_resource type="BTWait" id="BTWait_aa4xd"]
duration = 0.1

[sub_resource type="BTSequence" id="BTSequence_iaxgs"]
custom_name = "PlayerOverride"
children = [SubResource("BTCheckVar_asu1a"), SubResource("BTWait_aa4xd")]

[sub_resource type="BTCondition" id="BTCondition_brwnp"]
script = ExtResource("1_n2iu8")
need = "energy"

[sub_resource type="BTAction" id="BTFindBed_1"]
script = ExtResource("4_bed")

[sub_resource type="BTAction" id="BTMoveToBlackboard_shelter"]
script = ExtResource("2_move")
arrival_distance = 4.0

[sub_resource type="BTAction" id="BTAction_e4b4v"]
script = ExtResource("9_brwnp")

[sub_resource type="BBNode" id="BBNode_sbexb"]
saved_value = NodePath("UnitModel/AnimationPlayer")
resource_name = "UnitModel/AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_k7wm5"]
animation_player = SubResource("BBNode_sbexb")
animation_name = &"stand_up_from_laying_down"
speed = -1.0
from_end = true

[sub_resource type="BBNode" id="BBNode_m228g"]
saved_value = NodePath("UnitModel/AnimationPlayer")
resource_name = "UnitModel/AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_l2yjk"]
animation_player = SubResource("BBNode_m228g")
animation_name = &"sleeping_idle"
blend = 1.5

[sub_resource type="BTAction" id="BTAction_sbexb"]
script = ExtResource("5_8wn8u")
min_duration = 30.0
max_duration = 60.0

[sub_resource type="BTAction" id="BTAction_8jgo4"]
script = ExtResource("9_brwnp")
lock = false

[sub_resource type="BBNode" id="BBNode_0m3en"]
saved_value = NodePath("UnitModel/AnimationPlayer")
resource_name = "UnitModel/AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_j1a7u"]
animation_player = SubResource("BBNode_0m3en")
animation_name = &"stand_up_from_laying_down"

[sub_resource type="BTSequence" id="BTSequence_ql6da"]
custom_name = "SeekShelter"
children = [SubResource("BTCondition_brwnp"), SubResource("BTFindBed_1"), SubResource("BTMoveToBlackboard_shelter"), SubResource("BTAction_e4b4v"), SubResource("BTPlayAnimation_k7wm5"), SubResource("BTPlayAnimation_l2yjk"), SubResource("BTAction_sbexb"), SubResource("BTAction_8jgo4"), SubResource("BTPlayAnimation_j1a7u")]

[sub_resource type="BTCondition" id="BTCondition_8wn8u"]
script = ExtResource("1_n2iu8")
threshold = 60.0

[sub_resource type="BTAction" id="BTFindNearestResource_heat"]
script = ExtResource("3_resource")
resource_group = "heat_sources"

[sub_resource type="BTAction" id="BTMoveToBlackboard_warmth"]
script = ExtResource("2_move")

[sub_resource type="BTAction" id="BTAction_m228g"]
script = ExtResource("9_brwnp")

[sub_resource type="BTAction" id="BTAction_k7wm5"]
script = ExtResource("5_8wn8u")
min_duration = 30.0
max_duration = 45.0

[sub_resource type="BTAction" id="BTAction_l2yjk"]
script = ExtResource("9_brwnp")
lock = false

[sub_resource type="BTSequence" id="BTSequence_3jy6i"]
custom_name = "SeekWarmth"
children = [SubResource("BTCondition_8wn8u"), SubResource("BTFindNearestResource_heat"), SubResource("BTMoveToBlackboard_warmth"), SubResource("BTAction_m228g"), SubResource("BTAction_k7wm5"), SubResource("BTAction_l2yjk")]

[sub_resource type="BTCondition" id="BTCondition_hs587"]
script = ExtResource("1_n2iu8")
need = "hunger"
threshold = 60.0

[sub_resource type="BTAction" id="BTFindFoodContainer_1"]
script = ExtResource("5_food")

[sub_resource type="BTAction" id="BTMoveToBlackboard_food"]
script = ExtResource("2_move")
arrival_distance = 2.0

[sub_resource type="BTAction" id="BTAction_ohlgy"]
script = ExtResource("9_brwnp")

[sub_resource type="BTAction" id="BTAction_ullfr"]
script = ExtResource("5_8wn8u")
min_duration = 20.0
max_duration = 30.0

[sub_resource type="BTAction" id="BTAction_0m3en"]
script = ExtResource("9_brwnp")
lock = false

[sub_resource type="BTSequence" id="BTSequence_rdl7w"]
custom_name = "SeekFood"
children = [SubResource("BTCondition_hs587"), SubResource("BTFindFoodContainer_1"), SubResource("BTMoveToBlackboard_food"), SubResource("BTAction_ohlgy"), SubResource("BTAction_ullfr"), SubResource("BTAction_0m3en")]

[sub_resource type="BTAction" id="BTAction_rdl7w"]
script = ExtResource("1_wander")

[sub_resource type="BTAction" id="BTMoveToBlackboard_wander"]
script = ExtResource("2_move")

[sub_resource type="BTRandomWait" id="BTRandomWait_n2iu8"]
min_duration = 2.0
max_duration = 8.0

[sub_resource type="BTSequence" id="BTSequence_n2iu8"]
custom_name = "WanderSequence"
children = [SubResource("BTAction_rdl7w"), SubResource("BTMoveToBlackboard_wander"), SubResource("BTRandomWait_n2iu8")]

[sub_resource type="BTAction" id="BTAction_brwnp"]
script = ExtResource("6_3jy6i")

[sub_resource type="BTAction" id="BTAction_8wn8u"]
script = ExtResource("2_move")
arrival_distance = 1.5

[sub_resource type="BTAction" id="BTAction_hs587"]
script = ExtResource("7_ihniq")
face_away = true

[sub_resource type="BTAction" id="BTAction_aul44"]
script = ExtResource("9_brwnp")

[sub_resource type="BBNode" id="BBNode_y63l3"]
saved_value = NodePath("UnitModel/AnimationPlayer")
resource_name = "UnitModel/AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_bxk66"]
animation_player = SubResource("BBNode_y63l3")
animation_name = &"sitting_from_standing"

[sub_resource type="BBNode" id="BBNode_mslhm"]
saved_value = NodePath("UnitModel/AnimationPlayer")
resource_name = "UnitModel/AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_d5ls8"]
animation_player = SubResource("BBNode_mslhm")
animation_name = &"sitting_depressed"

[sub_resource type="BTRandomWait" id="BTRandomWait_y63l3"]
min_duration = 20.0
max_duration = 40.0

[sub_resource type="BTAction" id="BTAction_kd5rg"]
script = ExtResource("9_brwnp")
lock = false

[sub_resource type="BBNode" id="BBNode_aul44"]
saved_value = NodePath("UnitModel/AnimationPlayer")
resource_name = "UnitModel/AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_kd5rg"]
animation_player = SubResource("BBNode_aul44")
animation_name = &"sitting_from_standing"
speed = -1.0
from_end = true

[sub_resource type="BTSequence" id="BTSequence_bxk66"]
custom_name = "SitOnCrateSequence"
children = [SubResource("BTAction_brwnp"), SubResource("BTAction_8wn8u"), SubResource("BTAction_hs587"), SubResource("BTAction_aul44"), SubResource("BTPlayAnimation_bxk66"), SubResource("BTPlayAnimation_d5ls8"), SubResource("BTRandomWait_y63l3"), SubResource("BTAction_kd5rg"), SubResource("BTPlayAnimation_kd5rg")]

[sub_resource type="BTAction" id="BTAction_y63l3"]
script = ExtResource("3_resource")
resource_group = "heat_sources"

[sub_resource type="BTAction" id="BTAction_bxk66"]
script = ExtResource("8_rdl7w")
fire_distance = 4.0
min_spacing = 3.0

[sub_resource type="BTAction" id="BTAction_mslhm"]
script = ExtResource("2_move")
arrival_distance = 1.0

[sub_resource type="BTAction" id="BTAction_d5ls8"]
script = ExtResource("9_n2iu8")
target_var = &"fire_position"

[sub_resource type="BBNode" id="BBNode_rdl7w"]
saved_value = NodePath("UnitModel/AnimationPlayer")
resource_name = "UnitModel/AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_n2iu8"]
animation_player = SubResource("BBNode_rdl7w")
animation_name = &"crouch_to_stand"
speed = -1.0
from_end = true

[sub_resource type="BBNode" id="BBNode_e4b4v"]
saved_value = NodePath("UnitModel/AnimationPlayer")
resource_name = "UnitModel/AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_sbexb"]
animation_player = SubResource("BBNode_e4b4v")
animation_name = &"crouching_idle"

[sub_resource type="BTAction" id="BTAction_j1a7u"]
script = ExtResource("9_brwnp")

[sub_resource type="BTRandomWait" id="BTRandomWait_aul44"]
min_duration = 15.0
max_duration = 45.0

[sub_resource type="BBNode" id="BBNode_n2iu8"]
saved_value = NodePath("UnitModel/AnimationPlayer")
resource_name = "UnitModel/AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_brwnp"]
animation_player = SubResource("BBNode_n2iu8")
animation_name = &"crouch_to_stand"

[sub_resource type="BTAction" id="BTAction_43q60"]
script = ExtResource("9_brwnp")
lock = false

[sub_resource type="BTSequence" id="BTSequence_k7wm5"]
custom_name = "CrouchByFire"
children = [SubResource("BTPlayAnimation_n2iu8"), SubResource("BTPlayAnimation_sbexb"), SubResource("BTAction_j1a7u"), SubResource("BTRandomWait_aul44"), SubResource("BTPlayAnimation_brwnp"), SubResource("BTAction_43q60")]

[sub_resource type="BBNode" id="BBNode_ullfr"]
saved_value = NodePath("UnitModel/AnimationPlayer")
resource_name = "UnitModel/AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_m228g"]
animation_player = SubResource("BBNode_ullfr")
animation_name = &"idle"

[sub_resource type="BTAction" id="BTAction_o5lmo"]
script = ExtResource("9_brwnp")

[sub_resource type="BTRandomWait" id="BTRandomWait_l2yjk"]
min_duration = 15.0
max_duration = 45.0

[sub_resource type="BTAction" id="BTAction_ct5nu"]
script = ExtResource("9_brwnp")
lock = false

[sub_resource type="BTSequence" id="BTSequence_ohlgy"]
custom_name = "StandByFire"
children = [SubResource("BTPlayAnimation_m228g"), SubResource("BTAction_o5lmo"), SubResource("BTRandomWait_l2yjk"), SubResource("BTAction_ct5nu")]

[sub_resource type="BTRandomSelector" id="BTRandomSelector_y63l3"]
custom_name = "CrouchOrStand"
children = [SubResource("BTSequence_k7wm5"), SubResource("BTSequence_ohlgy")]

[sub_resource type="BTSequence" id="BTSequence_kd5rg"]
custom_name = "WarmByFire"
children = [SubResource("BTAction_y63l3"), SubResource("BTAction_bxk66"), SubResource("BTAction_mslhm"), SubResource("BTAction_d5ls8"), SubResource("BTRandomSelector_y63l3")]

[sub_resource type="BTRandomSelector" id="BTRandomSelector_mslhm"]
children = [SubResource("BTSequence_n2iu8"), SubResource("BTSequence_bxk66"), SubResource("BTSequence_kd5rg")]

[sub_resource type="BTSelector" id="BTSelector_brwnp"]
children = [SubResource("BTSequence_iaxgs"), SubResource("BTSequence_ql6da"), SubResource("BTSequence_3jy6i"), SubResource("BTSequence_rdl7w"), SubResource("BTRandomSelector_mslhm")]

[resource]
blackboard_plan = SubResource("BlackboardPlan_bo4pt")
root_task = SubResource("BTSelector_brwnp")
